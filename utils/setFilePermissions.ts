import { drive_v3 } from 'googleapis';

const defaultDescription = 'Uploaded by ðŸš€ Google Drive UploaderÂ²';
const defaultThumbnailBase64 =
	'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'; // Your full base64 encoded image string here

export const setFilePermissions = async ({
	drive,
	fileId,
	description = defaultDescription,
	thumbnailBase64 = defaultThumbnailBase64,
	setPublic = true,
	shareEmails = [],
}: {
	drive: drive_v3.Drive;
	fileId: string;
	description?: string;
	thumbnailBase64?: string;
	setPublic?: boolean;
	shareEmails?: string[];
}): Promise<{ status: boolean; message: string }> => {
	let status = false;
	let message = '';

	try {
		// Set file description and thumbnail
		const updateMetadata: drive_v3.Schema$File = {
			description,
			contentHints: {
				thumbnail: {
					image: thumbnailBase64, // Directly use the base64 string
					mimeType: 'image/jpeg', // Change the mime type based on your thumbnail type
				},
			},
		};

		await drive.files.update({
			fileId,
			requestBody: updateMetadata,
		});
		message = 'File metadata updated. ';

		// Set file to public if setPublic is true
		if (setPublic) {
			await drive.permissions.create({
				fileId,
				requestBody: { type: 'anyone', role: 'reader' },
			});
			message += 'File set to public. ';
		}

		// Share with specific emails if provided and not empty
		const validEmails = shareEmails.filter(email => email.trim() !== '');

		if (validEmails.length > 0) {
			for (const email of validEmails) {
				await drive.permissions.create({
					fileId,
					requestBody: { type: 'user', role: 'writer', emailAddress: email },
				});
			}
			message += `File shared with emails: ${validEmails.join(', ')}.`;
		} else if (!setPublic) {
			message += 'No valid emails provided to share the file with.';
		}

		status = true;
	} catch (error: any) {
		message = `Error: ${error.message}`;
	}

	return { status, message };
};
